<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated by PHP Project Wizard (PPW) 1.0.4 on Fri Aug 26 11:02:43 PDT 2011 -->

<project name="simplecart" default="build" basedir=".">
 <property name="source" value="src"/>

 <target name="clean" description="Clean up and create artifact directories">
  <delete dir="build/api"/>
  <delete dir="build/code-browser"/>
  <delete dir="build/coverage"/>
  <delete dir="build/logs"/>
  <delete dir="build/pdepend"/>

  <mkdir dir="build/api"/>
  <mkdir dir="build/code-browser"/>
  <mkdir dir="build/coverage"/>
  <mkdir dir="build/logs"/>
  <mkdir dir="build/pdepend"/>
 </target>

 <target name="phpunit" description="Run unit tests using PHPUnit and generates junit.xml and clover.xml">
  <coverage-setup database="build/coverage/coverage.db">
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
    </fileset>
  </coverage-setup>
  <phpunit haltonerror="true" bootstrap="tests/unit/bootstrap.php" codecoverage="true" >
    <formatter type="clover" todir="build/logs" outfile="clover.xml"></formatter>
    <formatter type="xml" todir="build/logs" outfile="junit.xml"></formatter>
    <batchtest>
      <fileset dir="tests/unit">
        <include name="**/*Test*.php"/>
        <exclude name="bootstrap.php"/>
      </fileset>
    </batchtest>
  </phpunit>
  <coverage-report outfile="build/logs/coverage.xml">
    <report todir="build/coverage" styledir="scripts"/>
  </coverage-report>
 </target>

 <target name="pdepend" description="Generate jdepend.xml and software metrics charts using PHP_Depend">
  <phpdepend>
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
   </fileset>
   <logger type="jdepend-xml" outfile="build/logs/jdepend.xml"/>
   <logger type="jdepend-chart" outfile="build/pdepend/dependencies.svg"/>
   <logger type="overview-pyramid" outfile="build/pdepend/overview-pyramid.svg"/>
  </phpdepend>
 </target>

 <target name="phpmd" description="Generate pmd.xml using PHPMD">
  <phpmd rulesets="codesize,design,naming,unusedcode">
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
   </fileset>
    <formatter type="xml" outfile="build/logs/pmd.xml"/>
  </phpmd>
 </target>

 <target name="phpcpd" description="Generate pmd-cpd.xml using PHPCPD">
  <phpcpd>
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
   </fileset>
    <formatter type="pmd" outfile="build/logs/pmd-cpd.xml"/>
  </phpcpd>
 </target>

 <target name="phploc" description="Generate phploc.csv">
  <exec command="phploc --log-csv build/logs/phploc.csv ${source}/system"/>
 </target>

 <target name="phpcs" description="Generate checkstyle.xml using PHP_CodeSniffer">
  <phpcodesniffer standard="Zend" showWarnings="false">
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
   </fileset>
    <formatter type="checkstyle" outfile="build/logs/checkstyle.xml"/>
  </phpcodesniffer>
 </target>

 <target name="phpdoc" description="Generate API documentation using PHPDocumentor">
  <phpdoc destdir="build/api" parseprivate="true" output="HTML:Smarty:PHP">
    <fileset dir="${source}/system">
      <include name="application/**.php" />
      <include name="forms/**.php" />
      <include name="models/**.php" />
      <include name="library/**.php" />
      <exclude name="library/Doctrine/*" />
      <exclude name="library/Zend/*" />
      <exclude name="library/ZendX/*" />
      <exclude name="library/Kint/*" />
      <exclude name="library/sfEventDispatcher/*" />
      <exclude name="library/sfYaml/*" />
      <exclude name="library/WideImage/*" />
      <exclude name="library/ZFDebug/*" />
      <exclude name="library/Danceric/*" />
      <exclude name="library/Imind/*" />
   </fileset>
    <projdocfileset dir="${project.basedir}">
      <include name="README" />
      <include name="INSTALL" />
    </projdocfileset>
  </phpdoc>
 </target>

 <target name="phpcb" description="Aggregate tool output with PHP_CodeBrowser">
  <exec command="phpcb --log build/logs --source ${source}/system --output build/code-browser" />
 </target>

 <target name="build" depends="clean,pdepend,phpmd,phpcpd,phpcs,phpdoc,phploc,phpunit,phpcb"/>
</project>
