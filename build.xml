<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated by PHP Project Wizard (PPW) 1.0.4 on Fri Aug 26 11:02:43 PDT 2011 -->

<project name="simplecart" default="build" basedir=".">
  <property name="source" value="src"/>

  <!-- Add Custom Tasks to the include path -->
  <includepath classpath="scripts/tasks/closure/tasks" />
  <taskdef name="yuicompressor" classname="YuiCompressorTask" />
  <taskdef name="closure" classname="ClosureTask" />

  <target name="clean" depends="clear-cache" description="Clean up and create artifact directories">
    <delete dir="build/api"/>
    <delete dir="build/code-browser"/>
    <delete dir="build/coverage"/>
    <delete dir="build/logs"/>
    <delete dir="build/pdepend"/>

    <mkdir dir="build/api"/>
    <mkdir dir="build/code-browser"/>
    <mkdir dir="build/coverage"/>
    <mkdir dir="build/logs"/>
    <mkdir dir="build/pdepend"/>
  </target>
  
  <target name="clear-cache" description="Clears cache folders">
    <delete dir="src/system/cache" includeemptydirs="false" failonerror="true" />
    <mkdir dir="src/system/cache"/>
    <chmod file="src/system/cache" mode="0777" />
  </target>

  <target name="phpunit" description="Run unit tests using PHPUnit and generates junit.xml and clover.xml">
    <coverage-setup database="build/coverage/coverage.db">
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
    </coverage-setup>
    <delete dir="tests/data/cache" includeemptydirs="false" failonerror="true" />
    <mkdir dir="tests/data/cache"/>
    <chmod file="tests/data/cache" mode="0777" />
    <phpunit haltonerror="false" bootstrap="tests/unit/bootstrap.php" codecoverage="true" >
      <formatter type="clover" todir="build/logs" outfile="clover.xml"></formatter>
      <formatter type="xml" todir="build/logs" outfile="junit.xml"></formatter>
      <batchtest>
        <fileset dir="tests/unit">
          <include name="**/*Test*.php"/>
          <exclude name="bootstrap.php"/>
        </fileset>
      </batchtest>
    </phpunit>
    <coverage-report outfile="build/logs/coverage.xml">
      <report todir="build/coverage" styledir="scripts/phing"/>
    </coverage-report>
  </target>

  <target name="pdepend" description="Generate jdepend.xml and software metrics charts using PHP_Depend">
    <phpdepend>
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
      <logger type="jdepend-xml" outfile="build/logs/jdepend.xml"/>
      <logger type="jdepend-chart" outfile="build/pdepend/dependencies.svg"/>
      <logger type="overview-pyramid" outfile="build/pdepend/overview-pyramid.svg"/>
    </phpdepend>
  </target>

  <target name="phpmd" description="Generate pmd.xml using PHPMD">
    <phpmd rulesets="codesize,design,naming,unusedcode">
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
      <formatter type="xml" outfile="build/logs/pmd.xml"/>
    </phpmd>
  </target>

  <target name="phpcpd" description="Generate pmd-cpd.xml using PHPCPD">
    <phpcpd>
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
      <formatter type="pmd" outfile="build/logs/pmd-cpd.xml"/>
    </phpcpd>
  </target>

  <target name="phploc" description="Generate phploc.csv">
    <exec command="phploc --log-csv build/logs/phploc.csv ${source}/system"/>
  </target>

  <target name="phpcs" description="Generate checkstyle.xml using PHP_CodeSniffer">
    <phpcodesniffer standard="spekkionu" showWarnings="false">
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
      <formatter type="default" usefile="false"/>
      <formatter type="checkstyle" outfile="build/logs/checkstyle.xml"/>
    </phpcodesniffer>
  </target>

  <target name="phpdoc" description="Generate API documentation using PHPDocumentor">
    <phpdoc destdir="build/api" parseprivate="false" output="HTML:Smarty:PHP">
      <fileset dir="${source}/system">
        <include name="forms/**.php" />
        <include name="models/**.php" />
        <include name="library/**.php" />
        <exclude name="library/Doctrine.php" />
        <exclude name="library/Doctrine/*" />
        <exclude name="library/Zend/*" />
        <exclude name="library/ZendX/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Kint/*" />
        <exclude name="library/Kint.php" />
        <exclude name="library/sfEventDispatcher/*" />
        <exclude name="library/sfYaml/*" />
        <exclude name="library/WideImage/*" />
        <exclude name="library/WideImage.php" />
        <exclude name="library/ZFDebug/*" />
        <exclude name="library/Danceric/*" />
        <exclude name="library/Imind/*" />
        <exclude name="library/HTMLPurifier.php" />
        <exclude name="library/HTMLPurifier/*" />
      </fileset>
      <projdocfileset dir="${project.basedir}">
        <include name="README" />
        <include name="INSTALL" />
      </projdocfileset>
    </phpdoc>
  </target>

  <target name="phpcb" description="Aggregate tool output with PHP_CodeBrowser">
    <exec command="phpcb --log build/logs --source ${source}/system --output build/code-browser" />
  </target>

  <target name="build" depends="clean,phpunit,pdepend,phpmd,phpcpd,phpcs,phpdoc,phploc,phpcb"/>

  <target name="cssmin" description="Combines and compresses css files">
    <echo message="Combine CSS Files" />
    <delete file="${source}/public_html/assets/styles/admin.min.css"/>
    <delete dir="build/tmp"/>
    <mkdir dir="build/tmp"/>
    <append destfile="build/tmp/admin.min.css">
      <filelist dir="${source}/public_html/assets" listfile="${source}/public_html/assets/styles/admin.txt"/>
    </append>
    <echo message="Compress combined css file"/>
    <yuicompressor target="${source}/public_html/assets/styles" type="css" compressorjar="${project.basedir}/scripts/tasks/yuicompressor/yuicompressor.jar"  verbose="true">
      <filelist dir="build/tmp" files="admin.min.css"></filelist>
    </yuicompressor>
    <delete dir="build/tmp"/>
  </target>

  <target name="jsmin" description="Combines and compresses javascript files">
    <echo message="Combine CSS Files" />

    <delete file="${source}/public_html/assets/scripts/admin.min.js"/>
    <delete dir="build/tmp"/>
    <mkdir dir="build/tmp"/>
    <append destfile="build/tmp/admin.min.js">
      <filelist dir="${source}/public_html/assets" listfile="${source}/public_html/assets/scripts/admin.txt"/>
    </append>
    <echo message="Compress combined js file"/>
    <yuicompressor target="${source}/public_html/assets/scripts" type="js" compressorjar="${project.basedir}/scripts/tasks/yuicompressor/yuicompressor.jar"  verbose="true">
      <filelist dir="build/tmp" files="admin.min.js"></filelist>
    </yuicompressor>
    <delete dir="build/tmp"/>
  </target>



</project>
